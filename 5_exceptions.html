
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>6. Errors and exceptions &#8212; Object oriented programming in Python for mathematicians 2020.0 documentation</title>
    <link rel="stylesheet" href="_static/fenics.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="_static/proof.css" />
    <link rel="stylesheet" type="text/css" href="_static/graphviz.css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/language_data.js"></script>
    <script src="_static/proof.js"></script>
    <script async="async" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="7. Inheritance and composition" href="6_inheritance.html" />
    <link rel="prev" title="5. Abstract data types" href="4_abstract_data_types.html" />
<!--[if lte IE 6]>
<link rel="stylesheet" href="_static/ie6.css" type="text/css" media="screen" charset="utf-8" />
<![endif]-->

<link rel="stylesheet" href="_static/featured.css">


<link rel="shortcut icon" href="_static/icon.ico" />


  </head><body>
<div class="wrapper">
  <a href="index.html"><img src="_static/banner.png" width="900px" alt="FInAT Project Banner" /></a>
  <div id="access">
    <div class="menu">
      <ul>
          <li class="page_item"><a href="https://github.com/finite-element/finite-element-course" title="GitHub">GitHub</a></li>
      </ul>
    </div><!-- .menu -->
  </div><!-- #access -->
</div><!-- #wrapper -->


    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <div class="section" id="errors-and-exceptions">
<span id="id1"></span><h1><span class="section-number">6. </span>Errors and exceptions<a class="headerlink" href="#errors-and-exceptions" title="Permalink to this headline">¶</a></h1>
<p>It is a sight familiar to every programmer: instead of producing the
desired result, the screen is filled with seemingly unintelligible
garbage because an error has occurred. Producing errors is an
unavoidable part of programming, so learning to understand and correct
them is an essential part of learning to program.</p>
<div class="section" id="what-is-an-error">
<h2><span class="section-number">6.1. </span>What is an error?<a class="headerlink" href="#what-is-an-error" title="Permalink to this headline">¶</a></h2>
<p>In mathematics, we are used to the idea that an expression might not
be defined. For example, in the absence of further information,
<span class="math notranslate nohighlight">\(0/0\)</span> does not have a well-defined value. Similarly, the string
of symbols <span class="math notranslate nohighlight">\(3 \times \%\)</span> does not have a mathematical
meaning. It is likewise very easy to create statements or expressions
in a programming language which either don’t have a well-defined
meaning, or which just don’t amount to a meaningful statement within
the rules of the language. A mathematician confronting an undefined
mathematical expression can do little else than throw up their hands
and ask the author what they meant. The <a class="reference internal" href="1_programs_in_files.html#term-Python-interpreter"><span class="xref std std-term">Python interpreter</span></a>, upon
encountering code which has no defined meaning, responds similarly,
though rather than raising its non-existent hands, it raises an
exception. It is then up to the programmer to divine what to do next.</p>
<p>Let’s take a look at what Python does in response to a simple
error:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="gp">In [3]: </span><span class="mf">0.</span><span class="o">/</span><span class="mf">0.</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ZeroDivisionError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">3</span><span class="o">-</span><span class="mf">4e5</span><span class="n">c12397e23</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="mf">0.</span><span class="o">/</span><span class="mf">0.</span>

<span class="ne">ZeroDivisionError</span>: float division by zero
</pre></div>
</div>
<p>An important rule in interpreting Python errors, the reasons for which we will
return to, is to always read the error message from the bottom up. In
this case, the last line contains the name of the exception which has
been raised <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ZeroDivisionError" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">ZeroDivisionError</span></code></a>, followed by a colon, followed by
a descriptive string providing more information about what has gone
wrong. In this case, that more or less says the same as the exception
name, but that won’t be the case for all exceptions. The four lines
above the exception are called a traceback. We’ll return to
interpreting tracebacks presently.</p>
<div class="section" id="syntax-errors">
<h3><span class="section-number">6.1.1. </span>Syntax errors<a class="headerlink" href="#syntax-errors" title="Permalink to this headline">¶</a></h3>
<p>Now consider the case of an expression that doesn’t make mathematical sense:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="gp">In [5]: </span><span class="mi">3</span> <span class="o">*</span> <span class="o">%</span>
<span class="gt">  File</span><span class="nn"> &quot;&lt;ipython-input-5-442f22cdc61f&gt;&quot;</span><span class="gt">, line </span><span class="mi">1</span>
<span class="g g-Whitespace">    </span><span class="mi">3</span> <span class="o">*</span> <span class="o">%</span>
        <span class="o">^</span>
<span class="ne">SyntaxError</span>: invalid syntax
</pre></div>
</div>
<p>This creates a syntax error, signified by a <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#SyntaxError" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">SyntaxError</span></code></a>
exception. In programming languages, as with human languages, the
syntax is the set of rules which defines which expressions are
well-formed. Notice that the earlier lines of a syntax error appear
somewhat different to those of the previous exception. Almost all
exceptions occur because the interpreter attempts to evaluate a
statement or expression and encounters a problem. Syntax errors are a
special case: when a syntax error occurs, the interpreter can’t even
get as far as attempting to evaluate because the sequence of
characters it has been asked to execute do not make sense in
Python. This does, however, have one advantage, which is that the
error message shows the precise point in the line at which the Python
interpreter found a problem. This is indicated by the caret symbol
(<code class="xref py py-obj docutils literal notranslate"><span class="pre">^</span></code>). In this case, the reason that the expression doesn’t make any
sense is that the modulo operator (<code class="xref py py-obj docutils literal notranslate"><span class="pre">%</span></code>) is not a permissible second
operand to multiplication (<code class="xref py py-obj docutils literal notranslate"><span class="pre">*</span></code>), so the Python interpreter places the
caret under the modulo operator.</p>
<p>Even though the Python interpreter will highlight the point at which
the syntax doesn’t make sense, this might not quite actually be the
point at which you made the mistake. In particular, failing to finish
a line of code will result in the interpreter assuming that the
expression continues on the next line of program text, resulting in
the syntax error appearing to be one line later than it really
occurs. Consider the following code:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
<p>The error here is a missing closing bracket on the first line, however
the error message which the <a class="reference internal" href="1_programs_in_files.html#term-Python-interpreter"><span class="xref std std-term">Python interpreter</span></a> prints when this code is run is:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span>  <span class="n">File</span> <span class="s2">&quot;syntax_error.py&quot;</span><span class="p">,</span> <span class="n">line</span> <span class="mi">2</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
        <span class="o">^</span>
<span class="ne">SyntaxError</span><span class="p">:</span> <span class="n">invalid</span> <span class="n">syntax</span>
</pre></div>
</div>
<p>To understand why Python reports the error on the line following the
actual problem, we need to understand that the missing closing bracket
was not by itself an error. The user could, after all, validly
continue the <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#tuple" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">tuple</span></code></a> constructor on the next line. For example,
the following code would be completely valid:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span>
     <span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
<p>This means that the <a class="reference internal" href="1_programs_in_files.html#term-Python-interpreter"><span class="xref std std-term">Python interpreter</span></a> can only know that something is
wrong when it sees <a class="reference external" href="https://docs.python.org/3/library/functions.html#print" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">print</span></code></a>, because <a class="reference external" href="https://docs.python.org/3/library/functions.html#print" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">print</span></code></a> cannot follow <code class="xref py py-obj docutils literal notranslate"><span class="pre">2</span></code> in a
tuple constructor. The interpreter, therefore, reports that the <a class="reference external" href="https://docs.python.org/3/library/functions.html#print" title="(in Python v3.9)"><code class="xref py py-obj docutils literal notranslate"><span class="pre">print</span></code></a>
is a syntax error.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>If the Python interpreter reports a syntax error at the start of a
line, always check to see if the actual error is on the previous
line.</p>
</div>
</div>
</div>
<div class="section" id="exceptions">
<h2><span class="section-number">6.2. </span>Exceptions<a class="headerlink" href="#exceptions" title="Permalink to this headline">¶</a></h2>
<p>Aside from syntax errors, which are handled directly by the
interpreter, errors occur when Python code is executed and something
goes wrong. In these cases the Python code in which the problem is
encountered must signal this to the interpreter. It does this using a
special kind of object called an <a class="reference internal" href="#term-exception"><span class="xref std std-term">exception</span></a>. When an exception
occurs, the interpreter stops executing the usual sequence of Python
commands. Unless the programmer has taken special measures, to which
we will return in <a class="reference internal" href="#handling-exceptions"><span class="std std-numref">Section 6.5</span></a>, the execution will
cease and an error message will result.</p>
<p>Because there are many things that can go wrong, Python has many types
of exception built in. For example, if we attempt to access the number
2 position in a tuple with only two entries, then an
<a class="reference external" href="https://docs.python.org/3/library/exceptions.html#IndexError" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">IndexError</span></code></a> exception occurs:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">IndexError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">1</span><span class="o">-</span><span class="n">def0bb43ba85</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>

<span class="ne">IndexError</span>: tuple index out of range
</pre></div>
</div>
<p>The exception type provides some indication as
to what has gone wrong, and there is usually also an error message and
sometimes more data to help diagnose the problem. The <a class="reference external" href="https://docs.python.org/3/library/exceptions.html" title="(in Python v3.9)"><span class="xref std std-doc">full list
of built-in exceptions</span></a> is available in the
Python documentation. Python developers can define their own
exceptions so there are many more defined in third-party packages.</p>
</div>
<div class="section" id="tracebacks-finding-errors">
<h2><span class="section-number">6.3. </span>Tracebacks: finding errors<a class="headerlink" href="#tracebacks-finding-errors" title="Permalink to this headline">¶</a></h2>
<p>The errors we have looked at so far have all been located in the top
level of code either typed directly into iPython or executed in a
script. However, what happens if an error occurs in a function call or
even several functions down? Consider the following code, which uses
the <code class="xref py py-class docutils literal notranslate"><span class="pre">Polynomial</span></code> class from
<a class="reference internal" href="2_objects.html#objects"><span class="std std-numref">chapter 3</span></a>:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="gp">In [1]: </span><span class="kn">from</span> <span class="nn">polynomial</span> <span class="kn">import</span> <span class="n">Polynomial</span>

<span class="gp">In [2]: </span><span class="n">p</span> <span class="o">=</span> <span class="n">Polynomial</span><span class="p">((</span><span class="s2">&quot;a&quot;</span><span class="p">,</span> <span class="s2">&quot;b&quot;</span><span class="p">))</span>

<span class="gp">In [3]: </span><span class="nb">print</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
<span class="go">bx + a</span>
</pre></div>
</div>
<p>So, perhaps surprisingly, we are able to define a polynomial whose
coefficients are letters, and we can even print the resulting
object. However, if we attempt to add this polynomial to the number 1,
we are in trouble:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="nb">print</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">141816221609</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span>

<span class="nn">~/docs/object-oriented-programming/src/polynomial.py</span> in <span class="ni">__radd__</span><span class="nt">(self, other)</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span>     <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">58</span>
<span class="ne">---&gt; </span><span class="mi">59</span>         <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>

<span class="nn">~/docs/object-oriented-programming/src/polynomial.py</span> in <span class="ni">__add__</span><span class="nt">(self, other)</span>
<span class="g g-Whitespace">     </span><span class="mi">38</span>
<span class="g g-Whitespace">     </span><span class="mi">39</span>         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">40</span>             <span class="k">return</span> <span class="n">Polynomial</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">other</span><span class="p">,)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span>
<span class="g g-Whitespace">     </span><span class="mi">42</span>         <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Polynomial</span><span class="p">):</span>

<span class="ne">TypeError</span>: can only concatenate str (not &quot;int&quot;) to str
</pre></div>
</div>
<p>This is a much larger error message than those we have previously
encountered, however, the same principles apply. We start by reading
the last line. This tells us that the error was a <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeError</span></code></a>
caused by attempting to concatenate (add) an integer to a
string. Where did this error occur? This is a more involved question
than it may first appear, and the rest of the error message above is
designed to help us answer this question. This type of error message
is called a <a class="reference internal" href="#term-traceback"><span class="xref std std-term">traceback</span></a>, as the second line of the error message
suggests. In order to understand this message, we need to understand a
little about how a Python program is executed, and in particular about
the call stack.</p>
<div class="section" id="the-call-stack">
<h3><span class="section-number">6.3.1. </span>The call stack<a class="headerlink" href="#the-call-stack" title="Permalink to this headline">¶</a></h3>
<p>A Python program is a sequence of Python statements, which are
executed in a sequence determined by the flow control logic of the
program itself. Each statement contains zero or more function calls <a class="footnote-reference brackets" href="#function" id="id2">1</a>,
which are executed in the course of evaluating that statement.</p>
<p>One of the most basic features of a function call is that the contents
of the function execute, and then the code which called the function
continues on from the point of the function call, using the return
value of the function in place of the call. Let’s think about what
happens when this occurs. Before calling the function, there is a
large amount of information which describes the context of the current
program execution. For example, there are all of the module, function,
and variable names which are in scope, and there is the record of
which instruction is next to be executed. This collection of
information about the current execution context is called a
<a class="reference internal" href="#term-stack-frame"><span class="xref std std-term">stack frame</span></a>. We learned about <a class="reference internal" href="4_abstract_data_types.html#term-stack"><span class="xref std std-term">stacks</span></a> in
<a class="reference internal" href="4_abstract_data_types.html#stacks"><span class="std std-numref">Section 5.1</span></a>, and the term “stack frame” is not a coincidence. The
Python interpreter maintains a <a class="reference internal" href="4_abstract_data_types.html#term-stack"><span class="xref std std-term">stack</span></a> of stack frames called
the <a class="reference internal" href="#term-call-stack"><span class="xref std std-term">call stack</span></a>. It is also sometimes called the
<a class="reference internal" href="#term-execution-stack"><span class="xref std std-term">execution stack</span></a> or <a class="reference internal" href="#term-interpreter-stack"><span class="xref std std-term">interpreter stack</span></a>.</p>
<p>The first frame on the stack contains the execution context for the
Python script that the user ran or, in the case where the user worked
interactively, for the iPython shell or Jupyter notebook into which
the user was typing. When a function is called, the Python interpreter
creates a new stack frame containing the local execution context of
that function and pushes it onto the call stack. When that function
returns, its stack frame is popped from the call stack, leaving the
interpreter to continue at the next instruction in the stack frame
from which the function was called. Because functions can call
functions which call functions and so on in a nearly limitless
sequence, there can be a number of stack frames in existence at any
time.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>FIXME: put in an illustration of a call stack here. Probably an
animation.</p>
</div>
</div>
<div class="section" id="interpreting-tracebacks">
<h3><span class="section-number">6.3.2. </span>Interpreting tracebacks<a class="headerlink" href="#interpreting-tracebacks" title="Permalink to this headline">¶</a></h3>
<p>Let’s return to the traceback for our erroneous polynomial addition:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="gp">In [4]: </span><span class="nb">print</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="mi">141816221609</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="nb">print</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p</span><span class="p">)</span>

<span class="nn">~/docs/object-oriented-programming/src/polynomial.py</span> in <span class="ni">__radd__</span><span class="nt">(self, other)</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span>     <span class="k">def</span> <span class="fm">__radd__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
<span class="g g-Whitespace">     </span><span class="mi">58</span>
<span class="ne">---&gt; </span><span class="mi">59</span>         <span class="k">return</span> <span class="bp">self</span> <span class="o">+</span> <span class="n">other</span>

<span class="nn">~/docs/object-oriented-programming/src/polynomial.py</span> in <span class="ni">__add__</span><span class="nt">(self, other)</span>
<span class="g g-Whitespace">     </span><span class="mi">38</span>
<span class="g g-Whitespace">     </span><span class="mi">39</span>         <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Number</span><span class="p">):</span>
<span class="ne">---&gt; </span><span class="mi">40</span>             <span class="k">return</span> <span class="n">Polynomial</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">other</span><span class="p">,)</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">coefficients</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
<span class="g g-Whitespace">     </span><span class="mi">41</span>
<span class="g g-Whitespace">     </span><span class="mi">42</span>         <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Polynomial</span><span class="p">):</span>

<span class="ne">TypeError</span>: can only concatenate str (not &quot;int&quot;) to str
</pre></div>
</div>
<p>This shows information about a <a class="reference internal" href="#term-call-stack"><span class="xref std std-term">call stack</span></a> comprising three
<a class="reference internal" href="#term-stack-frame"><span class="xref std std-term">stack frames</span></a>. Look first at the bottom-most
frame, which corresponds to the function in which the exception
occurred. The traceback for this frame starts:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">~/</span><span class="n">docs</span><span class="o">/</span><span class="nb">object</span><span class="o">-</span><span class="n">oriented</span><span class="o">-</span><span class="n">programming</span><span class="o">/</span><span class="n">src</span><span class="o">/</span><span class="n">polynomial</span><span class="o">.</span><span class="n">py</span> <span class="ow">in</span> <span class="fm">__add__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">)</span>
</pre></div>
</div>
<p>This indicates that the frame describes code in the file
<code class="xref py py-obj docutils literal notranslate"><span class="pre">polynomial.py</span></code> (which on the author’s computer is located in the
folder <code class="xref py py-obj docutils literal notranslate"><span class="pre">~/docs/object-oriented-programming/src/</span></code>). Specifically, the
stack frame describes the execution of the <code class="xref py py-meth docutils literal notranslate"><span class="pre">__add__()</span></code> method,
which is the <a class="reference internal" href="2_objects.html#term-special-method"><span class="xref std std-term">special method</span></a> responsible for polynomial
addition. The lines below this show the line on which execution
stopped (line 40, in this case) and a couple of lines on either side,
for context.</p>
<p>The stack frame above this shows the function from which the
<code class="xref py py-meth docutils literal notranslate"><span class="pre">__add__()</span></code> method was called. In this case, this is the reverse
addition <a class="reference internal" href="2_objects.html#term-special-method"><span class="xref std std-term">special method</span></a>, <code class="xref py py-meth docutils literal notranslate"><span class="pre">__radd__()</span></code>. On line 59 <code class="xref py py-meth docutils literal notranslate"><span class="pre">__radd__()</span></code> calls
<code class="xref py py-meth docutils literal notranslate"><span class="pre">__add__()</span></code> through the addition of <code class="xref py py-obj docutils literal notranslate"><span class="pre">self</span></code> and <code class="xref py py-obj docutils literal notranslate"><span class="pre">other</span></code>.</p>
<p>Finally, the top stack frame corresponds to the command that the user
typed in iPython. This stack frame looks a little different from the
others. For starters, instead of the file name there is the string
<code class="xref py py-obj docutils literal notranslate"><span class="pre">&lt;ipython-input-5-141816221609&gt;</span></code>. This is simply the <a class="reference internal" href="1_programs_in_files.html#term-Python-interpreter"><span class="xref std std-term">Python
interpreter</span></a>’s internal name for a notional “file” containing one line
of iPython input. Similarly, because the line the user typed is not in
any function, the interpreter treats it as code written in the top
level of an unnamed module called <code class="xref py py-obj docutils literal notranslate"><span class="pre">&lt;module&gt;</span></code>. Finally, because the
interpreter treats every line of input as a separate file, the call to
<code class="xref py py-meth docutils literal notranslate"><span class="pre">__radd__()</span></code> implementing the reverse addition of the number 1 to
the polynomial <code class="xref py py-obj docutils literal notranslate"><span class="pre">p</span></code> occurs on line 1 even though we are on the fourth
line of the iPython session.</p>
<div class="admonition hint">
<p class="admonition-title">Hint</p>
<p>The proximate cause of the error will be in the last <a class="reference internal" href="#term-stack-frame"><span class="xref std std-term">stack
frame</span></a> printed, so always read the <a class="reference internal" href="#term-traceback"><span class="xref std std-term">traceback</span></a> from the
bottom up. However, the ultimate cause of the problem is likely to
be further up the <a class="reference internal" href="#term-call-stack"><span class="xref std std-term">call stack</span></a>, so don’t stop reading at the
bottom frame!</p>
</div>
</div>
</div>
<div class="section" id="raising-exceptions">
<span id="id3"></span><h2><span class="section-number">6.4. </span>Raising exceptions<a class="headerlink" href="#raising-exceptions" title="Permalink to this headline">¶</a></h2>
<p>Thus far we’ve noticed that an exception occurs when something goes
wrong in a program, and that the <a class="reference internal" href="1_programs_in_files.html#term-Python-interpreter"><span class="xref std std-term">Python interpreter</span></a> will stop
at that point and print out a <a class="reference internal" href="#term-traceback"><span class="xref std std-term">traceback</span></a>. We’ll now examine the
process by which an exception occurs.</p>
<p>An exception is triggered using the <a class="reference external" href="https://docs.python.org/3/reference/simple_stmts.html#raise" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">raise</span></code></a> keyword. For
example, suppose we want to ensure that the input to our Fibonacci
function is an integer. All Python integers are <a class="reference internal" href="2_objects.html#term-instance"><span class="xref std std-term">instances</span></a> of <a class="reference external" href="https://docs.python.org/3/library/numbers.html#numbers.Integral" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">numbers.Integral</span></code></a>, so we can check this. If we
find a non-integer type then the consequence should be a
<a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeError</span></code></a>. This is achieved by <em>raising</em> the appropriate
exception, using the <a class="reference external" href="https://docs.python.org/3/reference/simple_stmts.html#raise" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">raise</span></code></a> statement. The keyword
<a class="reference external" href="https://docs.python.org/3/reference/simple_stmts.html#raise" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">raise</span></code></a> is followed by the exception. Almost all exceptions
take a string argument, which is the error message to be printed. In
<a class="reference internal" href="#typesafe-fib"><span class="std std-numref">Listing 6.1</span></a>, we inform the user that we were expecting an
integer rather than the type actually provided.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<span id="typesafe-fib"></span><div class="code-block-caption"><span class="caption-number">Listing 6.1 </span><span class="caption-text">A version of the Fibonacci function which raises an
exception if a non-integer type is passed as the
argument.</span><a class="headerlink" href="#id5" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">numbers</span> <span class="kn">import</span> <span class="n">Integral</span>

<span class="k">def</span> <span class="nf">typesafe_fib</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return the n-th Fibonacci number, raising an exception if a</span>
<span class="sd">    non-integer is passed as n.&quot;&quot;&quot;</span>
<span class="hll">    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">Integral</span><span class="p">):</span>
</span><span class="hll">           <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
</span><span class="hll">                  <span class="sa">f</span><span class="s2">&quot;fib expects an integer, not a </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">n</span><span class="p">)</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span>    <span class="k">if</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">elif</span> <span class="n">n</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">1</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">fib</span><span class="p">(</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>If we now pass a non-integer value to this function, we observe the following:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="gp">In [2]: </span><span class="n">typesafe_fib</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">TypeError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">2</span><span class="o">-</span><span class="n">c3aeb16193d4</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">typesafe_fib</span><span class="p">(</span><span class="mf">1.5</span><span class="p">)</span>

<span class="nn">~/docs/object-oriented-programming/fibonacci/fibonacci.py</span> in <span class="ni">typesafe_fib</span><span class="nt">(n)</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span>        <span class="n">non</span><span class="o">-</span><span class="n">integer</span> <span class="ow">is</span> <span class="n">passed</span> <span class="k">as</span> <span class="n">n</span><span class="o">.</span><span class="s2">&quot;&quot;&quot;</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span><span class="s2">        if not isinstance(n, Integral):</span>
<span class="ne">---&gt; </span><span class="mi">16</span><span class="s2">               raise TypeError(</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span><span class="s2">                      f&quot;fib expects an integer, not a {type(n).__name__}&quot;)</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span><span class="s2">        if n == 0:</span>

<span class="ne">TypeError</span>: fib expects an integer, not a float
</pre></div>
</div>
<p>This is exactly what we have come to expect: execution has stopped and
we see a <a class="reference internal" href="#term-traceback"><span class="xref std std-term">traceback</span></a>. Notice that the final line is the error
message that we passed to <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#TypeError" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">TypeError</span></code></a>. The only difference
between this and the previous errors we have seen is that the bottom
<a class="reference internal" href="#term-stack-frame"><span class="xref std std-term">stack frame</span></a> explicitly shows the exception being raised, while
previously the stack showed a piece of code where an error had
occurred. This minor difference has to do with whether the particular
piece of code where the exception occurred is written in Python, or is
written in a language such as C and called from Python. This
distinction is of negligible importance for our current purposes.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>An exceptionally common mistake that programmers make when first
trying to work with exceptions is to write:</p>
<div class="badcode docutils container">
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="ne">Exception</span>
</pre></div>
</div>
</div>
<p>instead of:</p>
<div class="goodcode docutils container">
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">raise</span> <span class="ne">Exception</span>
</pre></div>
</div>
</div>
<p>This mistake is the result of a confusion about what
<a class="reference external" href="https://docs.python.org/3/reference/simple_stmts.html#return" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">return</span></code></a> and <a class="reference external" href="https://docs.python.org/3/reference/simple_stmts.html#raise" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">raise</span></code></a> do. <a class="reference external" href="https://docs.python.org/3/reference/simple_stmts.html#return" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">return</span></code></a> means
“the function is finished, here is the result”. <a class="reference external" href="https://docs.python.org/3/reference/simple_stmts.html#raise" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">raise</span></code></a>
means “something exceptional happened, execution is stopping
without a result”.</p>
</div>
</div>
<div class="section" id="handling-exceptions">
<span id="id4"></span><h2><span class="section-number">6.5. </span>Handling exceptions<a class="headerlink" href="#handling-exceptions" title="Permalink to this headline">¶</a></h2>
<p>So far we have seen several different sorts of exception, how to raise
them, and how to understand the resulting <a class="reference internal" href="#term-traceback"><span class="xref std std-term">traceback</span></a>. The
<a class="reference internal" href="#term-traceback"><span class="xref std std-term">traceback</span></a> is very helpful if the exception was caused by a bug
in our code, so that we need to understand and correct the
error. However, sometimes an exception is a valid result of a valid
input, and we just need the program to do something out of the
ordinary to deal with the situation. For example, Euclid’s algorithm
for finding the greatest common divisor of <span class="math notranslate nohighlight">\(a\)</span> and <span class="math notranslate nohighlight">\(b\)</span> can
very nearly be written recursively as:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">gcd</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
<p>This works right up to the point where <code class="xref py py-obj docutils literal notranslate"><span class="pre">b</span></code> becomes zero, at which
point we should stop the recursion and return <code class="xref py py-obj docutils literal notranslate"><span class="pre">a</span></code>. What actually
happens if we run this code? Let’s try:</p>
<div class="highlight-ipython notranslate"><div class="highlight"><pre><span></span><span class="go">   In [5]: gcd(10, 12)</span>
<span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ZeroDivisionError</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="o">&lt;</span><span class="n">ipython</span><span class="o">-</span><span class="nb">input</span><span class="o">-</span><span class="mi">5</span><span class="o">-</span><span class="n">d0750d9f2658</span><span class="o">&gt;</span> <span class="ow">in</span> <span class="o">&lt;</span><span class="n">module</span><span class="o">&gt;</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">gcd</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>

<span class="nn">&lt;ipython-input-4-1ab7512041a6&gt;</span> in <span class="ni">gcd</span><span class="nt">(a, b)</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="k">def</span> <span class="nf">gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="k">return</span> <span class="n">gcd</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span><span class="p">)</span>

<span class="nn">&lt;ipython-input-4-1ab7512041a6&gt;</span> in <span class="ni">gcd</span><span class="nt">(a, b)</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="k">def</span> <span class="nf">gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="k">return</span> <span class="n">gcd</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span><span class="p">)</span>

<span class="nn">&lt;ipython-input-4-1ab7512041a6&gt;</span> in <span class="ni">gcd</span><span class="nt">(a, b)</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="k">def</span> <span class="nf">gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="k">return</span> <span class="n">gcd</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span><span class="p">)</span>

<span class="nn">&lt;ipython-input-4-1ab7512041a6&gt;</span> in <span class="ni">gcd</span><span class="nt">(a, b)</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="k">def</span> <span class="nf">gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="ne">----&gt; </span><span class="mi">2</span>     <span class="k">return</span> <span class="n">gcd</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span><span class="p">)</span>

<span class="ne">ZeroDivisionError</span>: integer division or modulo by zero
</pre></div>
</div>
<p>Notice how the recursive call to <code class="xref py py-func docutils literal notranslate"><span class="pre">gcd()</span></code> causes several
<a class="reference internal" href="#term-stack-frame"><span class="xref std std-term">stack frames</span></a> that look the same. That makes
sense: <code class="xref py py-func docutils literal notranslate"><span class="pre">gcd()</span></code> calls itself until <code class="xref py py-obj docutils literal notranslate"><span class="pre">b</span></code> is zero, and then we get a
<a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ZeroDivisionError" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ZeroDivisionError</span></code></a> because modulo zero is undefined. To
complete this function, what we need to do is to tell Python to stop
at the <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ZeroDivisionError" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ZeroDivisionError</span></code></a> and return <code class="xref py py-obj docutils literal notranslate"><span class="pre">a</span></code>
instead. <a class="reference internal" href="#gcd"><span class="std std-numref">Listing 6.2</span></a> illustrates how this can be achieved.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<span id="gcd"></span><div class="code-block-caption"><span class="caption-number">Listing 6.2 </span><span class="caption-text">A recursive implementation of Euclid’s algorithm which
catches the <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ZeroDivisionError" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ZeroDivisionError</span></code></a> to implement the
base case.</span><a class="headerlink" href="#id6" title="Permalink to this code">¶</a></div>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">gcd</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
<span class="hll">    <span class="k">try</span><span class="p">:</span>
</span>        <span class="k">return</span> <span class="n">gcd</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">a</span> <span class="o">%</span> <span class="n">b</span><span class="p">)</span>
<span class="hll">    <span class="k">except</span> <span class="ne">ZeroDivisionError</span><span class="p">:</span>
</span><span class="hll">        <span class="k">return</span> <span class="n">a</span>
</span></pre></div>
</div>
</div>
<p>The new structure here is the <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#try" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">try</span></code></a>… <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#except" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">except</span></code></a>
block. The <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#try" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">try</span></code></a> keyword defines a block of code, in this
case just containing <code class="xref py py-obj docutils literal notranslate"><span class="pre">return</span> <span class="pre">gcd(b,</span> <span class="pre">a</span> <span class="pre">%</span> <span class="pre">b)</span></code>. The <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#except" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">except</span></code></a> is
optionally followed by an exception class, or a tuple of exception
classes. This case, the <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#except" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">except</span></code></a> is only followed by the
<a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ZeroDivisionError" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ZeroDivisionError</span></code></a> class. What this means is that if a
<a class="reference external" href="https://docs.python.org/3/library/exceptions.html#ZeroDivisionError" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ZeroDivisionError</span></code></a> is raised by any of the code inside the
<a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#try" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">try</span></code></a> block then, instead of execution halting and a
<a class="reference internal" href="#term-traceback"><span class="xref std std-term">traceback</span></a> being printed, the code inside the <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#except" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">except</span></code></a>
block is run.</p>
<p>In the example here, this means that once <code class="xref py py-obj docutils literal notranslate"><span class="pre">b</span></code> is zero, instead of
<code class="xref py py-obj docutils literal notranslate"><span class="pre">gcd</span></code> being called a further time, a is returned. If we run this
version of <code class="xref py py-func docutils literal notranslate"><span class="pre">gcd()</span></code> then we have, as we might expect:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="gp">In [2]: </span><span class="n">gcd</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">)</span>
<span class="gh">Out[2]: </span><span class="go">2</span>
</pre></div>
</div>
<div class="section" id="except-clauses">
<h3><span class="section-number">6.5.1. </span>Except clauses<a class="headerlink" href="#except-clauses" title="Permalink to this headline">¶</a></h3>
<p>Let’s look in a little more detail at how <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#except" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">except</span></code></a> works.</p>
</div>
<div class="section" id="else-and-finally">
<h3><span class="section-number">6.5.2. </span>Else and finally<a class="headerlink" href="#else-and-finally" title="Permalink to this headline">¶</a></h3>
</div>
<div class="section" id="exception-handling-and-the-call-stack">
<h3><span class="section-number">6.5.3. </span>Exception handling and the call stack<a class="headerlink" href="#exception-handling-and-the-call-stack" title="Permalink to this headline">¶</a></h3>
<p>An <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#except" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">except</span></code></a> block will handle any exception raised in the
preceding <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#try" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">try</span></code></a> block. The <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#try" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">try</span></code></a> block can, of
course, contain any code at all. In particular it might contain
function calls which themselves may well call further functions. This
means that an exception might occur several <a class="reference internal" href="#term-stack-frame"><span class="xref std std-term">stack frames</span></a> down the <a class="reference internal" href="#term-call-stack"><span class="xref std std-term">call stack</span></a> from the <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#try" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">try</span></code></a>
clause. Indeed, some of the functions called might themselves contain
<a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#try" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">try</span></code></a> blocks with the result that an exception is raised at a
point which is ultimately inside several <a class="reference external" href="https://docs.python.org/3/reference/compound_stmts.html#try" title="(in Python v3.9)"><code class="xref std std-keyword docutils literal notranslate"><span class="pre">try</span></code></a> blocks.</p>
<p>The <a class="reference internal" href="1_programs_in_files.html#term-Python-interpreter"><span class="xref std std-term">Python interpreter</span></a> deals with this situation by starting
from the current <a class="reference internal" href="#term-stack-frame"><span class="xref std std-term">stack frame</span></a> and working upwards, a process
known as <em>unwinding the stack</em>. In pseudocode, the algorithm is:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="k">while</span> <span class="n">call</span> <span class="n">stack</span> <span class="ow">not</span> <span class="n">empty</span><span class="p">:</span>
    <span class="k">if</span> <span class="n">current</span> <span class="n">execution</span> <span class="n">point</span> <span class="ow">is</span> <span class="ow">in</span> <span class="n">a</span> <span class="k">try</span> <span class="n">block</span> \
            <span class="k">with</span> <span class="n">an</span> <span class="k">except</span> <span class="n">matching</span> <span class="n">the</span> <span class="n">current</span> <span class="n">exception</span><span class="p">:</span>
        <span class="n">execution</span> <span class="n">continues</span> <span class="ow">in</span> <span class="n">the</span> <span class="k">except</span> <span class="n">block</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pop</span> <span class="n">the</span> <span class="n">current</span> <span class="n">stack</span> <span class="n">frame</span> <span class="n">off</span> <span class="n">the</span> <span class="n">call</span> <span class="n">stack</span>

<span class="c1"># Call stack is now empty</span>
<span class="nb">print</span> <span class="n">traceback</span> <span class="ow">and</span> <span class="n">exit</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="exceptions-are-not-always-errors">
<h2><span class="section-number">6.6. </span>Exceptions are not always errors<a class="headerlink" href="#exceptions-are-not-always-errors" title="Permalink to this headline">¶</a></h2>
<p>This chapter is called “Errors and exceptions”, so it is appropriate
to finish by drawing attention to the distinction between these two
concepts. While user errors and bugs in programs typically result in
an exception being raised, it is not the case that all exceptions
result from errors. The name “exception” means what it says, it is an
event whose occurrence requires an exception to the normal sequence of
execution.</p>
<p>The <a class="reference external" href="https://docs.python.org/3/library/exceptions.html#StopIteration" title="(in Python v3.9)"><code class="xref py py-class docutils literal notranslate"><span class="pre">StopIteration</span></code></a> exception which we encountered in
<a class="reference internal" href="4_abstract_data_types.html#iterator-protocol"><span class="std std-numref">Section 5.5</span></a> is a good example of an <a class="reference internal" href="#term-exception"><span class="xref std std-term">exception</span></a>
which does not indicate an error. The end of the set of things to be
iterated over does not indicate that something has gone wrong, but it
is an exception to the usual behaviour of <a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#iterator.__next__" title="(in Python v3.9)"><code class="xref py py-meth docutils literal notranslate"><span class="pre">__next__()</span></code></a>,
which Python needs to handle in a different way from simply returning
the next item.</p>
</div>
<div class="section" id="glossary">
<h2><span class="section-number">6.7. </span>Glossary<a class="headerlink" href="#glossary" title="Permalink to this headline">¶</a></h2>
<blockquote>
<div><dl class="glossary simple">
<dt id="term-call-stack">call stack</dt><dt id="term-execution-stack">execution stack</dt><dt id="term-interpreter-stack">interpreter stack</dt><dd><p>The <a class="reference internal" href="4_abstract_data_types.html#term-stack"><span class="xref std std-term">stack</span></a> of <a class="reference internal" href="#term-stack-frame"><span class="xref std std-term">stack frames</span></a> in existence. The
current item on the stack is the currently executing function,
while the deepest item is the stack frame corresponding to the
user script or interpreter.</p>
</dd>
<dt id="term-exception">exception</dt><dd><p>An object representing an out of the ordinary event which has
occurred during the execution of some Python code. When an
exception is <a class="reference internal" href="#raising-exceptions"><span class="std std-ref">raised</span></a> the
<a class="reference internal" href="1_programs_in_files.html#term-Python-interpreter"><span class="xref std std-term">Python interpreter</span></a> doesn’t continue to execute the
following line of code. Instead, the exception is either
<a class="reference internal" href="#handling-exceptions"><span class="std std-ref">handled</span></a> or execution stops and a
<a class="reference internal" href="#term-traceback"><span class="xref std std-term">traceback</span></a> is printed.</p>
</dd>
<dt id="term-stack-frame">stack frame</dt><dd><p>An object encapsulating the set of variables which define the
execution of a Python script or function. This information
includes the code being executed, all the local and global
names which are visible, the last instruction that was
executed, and a reference to the stack frame which called this
function.</p>
</dd>
<dt id="term-syntax">syntax</dt><dd><p>The set of rules which define what is a well-formed Python
statement. For example the rule that statements which start
blocks must end with a colon (:) is a syntax rule.</p>
</dd>
<dt id="term-syntax-error">syntax error</dt><dd><p>The <a class="reference internal" href="#term-exception"><span class="xref std std-term">exception</span></a> which occurs when a statement violates
the <a class="reference internal" href="#term-syntax"><span class="xref std std-term">syntax</span></a> rules of Python. Mismatched brackets,
missing commas, and incorrect indentation are all examples of
syntax errors.</p>
</dd>
<dt id="term-traceback">traceback</dt><dt id="term-stack-trace">stack trace</dt><dt id="term-back-trace">back trace</dt><dd><p>A text representation of the <a class="reference internal" href="#term-call-stack"><span class="xref std std-term">call stack</span></a>. A traceback
shows a few lines of code around the current execution point
in each <a class="reference internal" href="#term-stack-frame"><span class="xref std std-term">stack frame</span></a>, with the current frame at the
bottom and the outermost frame at the top.</p>
</dd>
</dl>
</div></blockquote>
<p class="rubric">Footnotes</p>
<dl class="footnote brackets">
<dt class="label" id="function"><span class="brackets"><a class="fn-backref" href="#id2">1</a></span></dt>
<dd><p>“Function call” here includes <a class="reference internal" href="2_objects.html#term-method"><span class="xref std std-term">method</span></a> calls and
operations implemented using a <a class="reference internal" href="2_objects.html#term-special-method"><span class="xref std std-term">special method</span></a>.</p>
</dd>
</dl>
</div>
</div>


            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer" role="contentinfo">
        &#169; Copyright 2019-2020, David A. Ham.
      Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 3.2.1.
    </div>
  </body>
</html>